# Overview
This application authenticates any route with a base URL that matches foo or bar.
Each base URL accepts one set of credentails and all sub paths use the same credential

## Getting Started

1. Install node: https://nodejs.org/en/download/
2. Install kubectl: https://kubernetes.io/docs/tasks/tools/install-kubectl/
3. Install helm: https://helm.sh/docs/intro/install/
4. Create env.yaml file in /server folder: see below
env.yaml
``` 
configuration:
 - credential: hello
    path: /foo
 - credential: world
    path: /bar
 ```

## Project structure
```
project
│   README.md
│   packages
│
└───bin
│   │   www (This is the server spin up)
│   └───subfolder1
│       │   file111.txt
│       │   file112.txt
│       │   ...
│   
└───server
│   │   server.js (This is where middleware is injected)
│   └───views  (Location of all the rendered pages using jade)
│   └───routes (This is were all subroutes are define for a base path)
│   └───common (This is shared components and middleware)
│   └───public (Public stylesheets and assets)
└───Deployment
   │   
   └───kube-auth (Helm chart)
   │   values.yaml (overide file for helm)

```
## Development
1. Application server startup is in bin/www
2. Application server middleware is defined in server/server.js
    1. Root paths are defined here so /foo or /bar
3. Routes are defined in /server/routes

 ### To Run:
Command line:
 1. npm install (from root folder)
 2. npm start

VS Code:
  1. F5
  2. Choose node.js runner

## Deploy Setup
1. Helm chart under /deployment
2. values file to override in /deployment
3. configmap which is mounted to the container upon deployment which defines the secrets and auth

## To deploy
1. helm install stable/nginx-ingress  -n auth-test-ingress --set controller.ingressClass=auth-test (!!! only need to be run once !!!)
2. cd deployment
3. Modify values.yaml file to the specific values you would like or set them via the helm install
4. helm install ./kube-auth-express -n auth-test -f values.yaml

## Master Images
1. Images are auto created from the github repository generated by Docker. They are built of the master branch
2. Images are tagged in this format version-{\1}



Resources:
 * https://github.com/goldbergyoni/nodebestpractices/blob/master/section/projectstructre/configguide.md
 * https://github.com/nodejs/docker-node/blob/master/docs/BestPractices.md
 * https://docs.bitnami.com/tutorials/series/best-practices-helm/
 * https://expressjs.com/


